<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Orm Caption Generator</title>

<style>
:root{
  --bg0:#fbfbf9;
  --bg1:#f1f1ef;
  --ink:#0b0b0c;
  --muted:#8a8a90;
  --card:#ffffff;
  --gold:#c6a75e;
  --btn-border:#e7e7ea;
  --shadow:0 28px 90px rgba(0,0,0,.09);
  --radius:26px;
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial;
  color:var(--ink);
  background:
    radial-gradient(1200px 700px at 20% -10%, rgba(198,167,94,.12), transparent 60%),
    linear-gradient(180deg,var(--bg0),var(--bg1));
}

.wrap{max-width:860px;margin:0 auto;padding:22px 18px 52px}

/* HERO */
.hero{
  position:relative;
  border-radius:30px;
  overflow:hidden;
  box-shadow:0 30px 100px rgba(0,0,0,.18);
  margin:8px 0 22px;
  background:#000;
}
.hero img{
  width:100%;
  height:440px;
  object-fit:cover;
  display:block;
}
.hero::after{
  content:"";
  position:absolute;
  inset:0;
  background:linear-gradient(to top, rgba(0,0,0,.82), rgba(0,0,0,.18) 55%, rgba(0,0,0,0));
}
.hero-overlay{
  position:absolute;
  left:22px;
  right:22px;
  bottom:18px;
  color:#fff;
}
.hero-title{
  font-size:clamp(24px,6.2vw,40px);
  font-weight:900;
  letter-spacing:1.4px;
  text-transform:uppercase;
}
.hero-sub{
  margin-top:6px;
  font-size:12px;
  font-weight:800;
  letter-spacing:.2em;
  text-transform:uppercase;
}

/* Heading */
h1{
  margin:10px 0 6px;
  font-weight:900;
  font-size:clamp(22px,4.8vw,30px);
}
.gold-line{
  width:72px;
  height:2px;
  background:linear-gradient(90deg, transparent 0%, var(--gold) 18%, var(--gold) 82%, transparent 100%);
  margin:12px 0 22px;
  border-radius:999px;
}

/* Modes */
.modes{
  display:flex;gap:26px;align-items:center;
  margin:6px 0 16px;
  font-weight:700;
}
input[type="radio"]{accent-color:var(--ink)}

/* Card */
.card{
  background:rgba(255,255,255,.85);
  border:1px solid rgba(0,0,0,.08);
  backdrop-filter:blur(10px);
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  padding:22px;
}

.head{
  display:flex;align-items:center;gap:14px;flex-wrap:wrap;
  margin-bottom:14px;
  padding-bottom:12px;
  border-bottom:1px solid rgba(0,0,0,.08);
}
.brand{
  font-weight:900;
  font-size:18px;
}
.pill{
  font-size:12px;
  font-weight:900;
  letter-spacing:.18em;
  text-transform:uppercase;
  color:var(--muted);
  margin-left:8px;
}

.actions{margin-left:auto;display:flex;gap:12px}

.iconbtn{
  width:46px;height:44px;
  border-radius:14px;
  border:1px solid var(--btn-border);
  background:#fff;
  font-size:18px;
  cursor:pointer;
  transition:.2s;
}
.iconbtn:hover{
  border-color:rgba(198,167,94,.85);
  color:var(--gold);
  transform:translateY(-1px);
}
.iconbtn.active{
  border-color:var(--gold);
  color:var(--gold);
  background:rgba(198,167,94,.08);
  box-shadow:0 0 0 1px rgba(198,167,94,.4),
             0 12px 30px rgba(198,167,94,.25);
}

.caption{
  white-space:pre-wrap;
  font-weight:600;
  font-size:16px;
  line-height:1.6;
}

.toast{
  position:fixed;
  left:50%;
  bottom:26px;
  transform:translateX(-50%);
  background:#111;
  color:#fff;
  padding:9px 14px;
  border-radius:999px;
  font-weight:800;
  opacity:0;
  transition:.25s;
}
.toast.show{opacity:1}
</style>
</head>

<body>
<div class="wrap">

  <section class="hero">
    <img src="orm.jpg" alt="Orm Kornnaphat">
    <div class="hero-overlay">
      <div class="hero-title">Orm Kornnaphat</div>
      <div class="hero-sub">BVLGARI • CAPTION GENERATOR</div>
    </div>
  </section>

  <h1>Orm Kornnaphat X BVLGARI</h1>
  <div class="gold-line"></div>

  <div class="modes">
    <label><input type="radio" name="platform" value="ig" checked> Instagram</label>
    <label><input type="radio" name="platform" value="x"> X (Twitter)</label>
  </div>

  <div class="card">
    <div class="head">
      <div class="brand">Orm Kornnaphat <span class="pill" id="pillType">post</span></div>
      <div class="actions">
        <button class="iconbtn" id="btnRand">⟳</button>
        <button class="iconbtn" id="btnEdit">T</button>
        <button class="iconbtn" id="btnCopy">⧉</button>
      </div>
    </div>
    <div class="caption" id="captionBox" contenteditable="false">
      Press ⟳ to load captions
    </div>
  </div>

</div>

<div class="toast" id="toast">Copied</div>

<script>
const SHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRdPtHYl8KRLNJOXKZ9gC5RPQoF5aHWlwfSHG90HbYRrZPsi2LLv3J2u_WJ8g5f7n16zZPORBaMNqqq/pub?output=csv";

let DB = { ig: [], x: [] };
let currentText = "";
let isEdit = false;

const captionBox = document.getElementById("captionBox");
const pillType = document.getElementById("pillType");
const toast = document.getElementById("toast");
const editBtn = document.getElementById("btnEdit");

function showToast(){
  toast.classList.add("show");
  setTimeout(()=>toast.classList.remove("show"),1000);
}

/* Robust CSV parser */
function parseCSV(text){
  const rows = [];
  let row = [], cur = "", inQuotes = false;

  for(let i=0;i<text.length;i++){
    const ch = text[i], next = text[i+1];

    if(ch === '"' && inQuotes && next === '"'){ cur += '"'; i++; continue; }
    if(ch === '"'){ inQuotes = !inQuotes; continue; }

    if(ch === ',' && !inQuotes){ row.push(cur); cur=""; continue; }
    if((ch === '\n' || ch === '\r') && !inQuotes){
      if(ch === '\r' && next === '\n') i++;
      row.push(cur);
      if(row.some(v=>v.trim()!=="")) rows.push(row);
      row=[]; cur=""; continue;
    }
    cur+=ch;
  }
  row.push(cur);
  if(row.some(v=>v.trim()!=="")) rows.push(row);
  return rows;
}

function normalizePlatform(raw){
  const p = (raw||"").trim().toLowerCase();
  if(p==="ig"||p==="instagram") return "ig";
  if(p==="x"||p==="twitter"||p.includes("twitter")) return "x";
  return "";
}

async function loadData(){
  const res = await fetch(SHEET_URL,{cache:"no-store"});
  const csv = await res.text();
  const table = parseCSV(csv);
  const rows = table.slice(1);

  DB={ig:[],x:[]};

  rows.forEach(cols=>{
    const key = normalizePlatform(cols[0]);
    const text = (cols[1]||"").trim();
    if(key && text) DB[key].push(text);
  });
}

function generate(){
  const p=document.querySelector('input[name="platform"]:checked').value;
  const arr=DB[p]||[];
  if(arr.length===0){
    captionBox.textContent="No captions available.";
    return;
  }
  const rand=arr[Math.floor(Math.random()*arr.length)];
  currentText=rand;
  captionBox.textContent=rand;
  pillType.textContent=p==="ig"?"post":"tweet";
}

document.getElementById("btnRand").addEventListener("click",async()=>{
  captionBox.textContent="Loading...";
  await loadData();
  generate();
});

document.getElementById("btnCopy").addEventListener("click",async()=>{
  if(!captionBox.textContent.trim())return;
  await navigator.clipboard.writeText(captionBox.textContent);
  showToast();
});

editBtn.addEventListener("click",()=>{
  isEdit=!isEdit;
  captionBox.contentEditable=isEdit;
  captionBox.style.outline=isEdit?"2px solid #c6a75e":"none";
  editBtn.classList.toggle("active",isEdit);
});
</script>

</body>
</html>
